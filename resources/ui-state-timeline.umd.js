(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('.history-timeline[data-v-e9c3e6de]{position:relative;min-height:110px;box-sizing:border-box}.timeline-bar[data-v-e9c3e6de]{display:flex;flex-direction:row;width:100%;cursor:default;align-items:center}.timeline-segment[data-v-e9c3e6de]{height:100%;cursor:pointer;box-sizing:border-box;transition:box-shadow .2s ease,border .2s ease,transform .2s ease-in,border-radius .2s ease-in;transform-origin:center center;border-radius:0}.timeline-segment[data-v-e9c3e6de]:first-child{border-top-left-radius:6px;border-bottom-left-radius:6px}.timeline-segment[data-v-e9c3e6de]:last-child{border-top-right-radius:6px;border-bottom-right-radius:6px}.timeline-segment[data-v-e9c3e6de]:hover:not(.selected),.timeline-segment.selected[data-v-e9c3e6de]{transform:scaleY(1.3);z-index:5;border-radius:6px}.timeline-segment[data-v-e9c3e6de]:hover:not(.selected){box-shadow:0 0 15px 5px #0009}.timeline-segment.selected[data-v-e9c3e6de]{border:2px solid #000;box-shadow:0 0 15px 5px #0009}.timeline-segment:first-child.selected[data-v-e9c3e6de]{border-top-left-radius:6px;border-bottom-left-radius:6px}.timeline-segment:last-child.selected[data-v-e9c3e6de]{border-top-right-radius:6px;border-bottom-right-radius:6px}.no-data[data-v-e9c3e6de]{text-align:center;color:#888;padding:20px;font-style:italic}.time-axis[data-v-e9c3e6de]{position:relative;width:100%;height:20px;margin-top:8px;overflow:visible;-webkit-user-select:none;user-select:none}.time-marker[data-v-e9c3e6de]{position:absolute;bottom:0;transform:translate(-50%);font-size:10px;white-space:nowrap}.time-marker[data-v-e9c3e6de]:before{content:"";position:absolute;bottom:calc(100% + 1px);left:50%;transform:translate(-50%);width:1px;height:4px;background-color:#aaa}.ui-state-timeline[data-v-e9c3e6de]{display:flex;align-items:center;justify-content:space-between}.legend[data-v-e9c3e6de]{margin-top:15px;display:flex;justify-content:center;flex-wrap:wrap;padding:0 10px;gap:10px}.legend-item[data-v-e9c3e6de]{display:inline-flex;align-items:center;font-size:.8rem}.color-box[data-v-e9c3e6de]{display:inline-block;width:12px;height:12px;margin-right:5px;border-radius:3px;border:1px solid rgba(0,0,0,.1)}.details-card[data-v-e9c3e6de]{box-shadow:0 2px 10px #0003}.details-card .v-list-item[data-v-e9c3e6de]{min-height:28px;padding-top:2px;padding-bottom:2px}.details-card .v-list-item-title[data-v-e9c3e6de],.details-card .v-list-item-subtitle[data-v-e9c3e6de]{line-height:1.3}.details-card .v-card-title[data-v-e9c3e6de]{font-weight:700}.nrdb-ui-state-timeline-title[data-v-e9c3e6de]{display:block;text-align:center;font-weight:700;font-size:1rem;padding-bottom:4px}')),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
(function(h,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vuex"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vuex","vue"],f):(h=typeof globalThis<"u"?globalThis:h||self,f(h["ui-state-timeline"]={},h.vuex,h.Vue))})(this,function(h,f,t){"use strict";const _=(a,e)=>{const i=a.__vccOpts||a;for(const[o,c]of e)i[o]=c;return i},D={name:"DBStateTimeline",inject:["$socket","$dataTracker"],props:{id:{type:String,required:!0},props:{type:Object,default:()=>({})},state:{type:Object,default:()=>({})}},data(){return{}},computed:{...f.mapState("data",["messages"]),stateData(){var a,e;return((e=(a=this.messages[this.id])==null?void 0:a.payload)==null?void 0:e.stateData)||[]},title(){return this.getProperty("title")||"State Timeline"},barHeight(){return this.getProperty("barHeight")||30},timeFormat(){return this.getProperty("timeFormat")||"hh:mm a"},minTimeLabelGap(){return this.getProperty("minTimeLabelGap")||6},showTimeMarkers(){return this.getProperty("showTimeMarkers")!==void 0?!!this.getProperty("showTimeMarkers"):!0},showOnlyStartEndTimes(){return this.showTimeMarkers&&!!this.getProperty("showOnlyStartEndTimes")},stateDefinitions(){const a=this.getProperty("states");return Array.isArray(a)&&a.length>=2?a:(console.warn(`State definitions (props.states) for ${this.id} are missing or invalid. Using defaults.`),[{label:"On",value:"on",valueType:"str",color:"#009933"},{label:"Off",value:"off",valueType:"str",color:"#999999"}])},totalStartMs(){return this.stateData.length>0?new Date(this.stateData[0].start).getTime():null},totalEndMs(){return this.stateData.length>0?new Date(this.stateData[this.stateData.length-1].end).getTime():null},totalDurationMs(){return this.totalEndMs&&this.totalStartMs&&this.totalEndMs>this.totalStartMs?this.totalEndMs-this.totalStartMs:this.stateData.length>0&&this.totalEndMs===this.totalStartMs?1:0},timeMarkers(){if(!this.stateData.length||this.totalDurationMs<=0)return[];const a=[],e=this.totalStartMs,i=this.totalDurationMs;a.push({label:this.formatTime(new Date(e)),position:0,time:e}),this.stateData.forEach((n,m)=>{const l=new Date(n.end).getTime();if(!a.some(d=>d.time===l)){const d=Math.min(100,Math.max(0,(l-e)/i*100));a.push({label:this.formatTime(new Date(n.end)),position:d,time:l})}}),a.sort((n,m)=>n.position-m.position||n.time-m.time);const o=[],c=Number(this.minTimeLabelGap)>=0?Number(this.minTimeLabelGap):6;let r=null;return a.forEach((n,m)=>{const l=m===0,d=m===a.length-1;if(l)o.push(n),r=n;else{if(!r)return;const p=n.position-r.position;d?(p<c&&o.length>1&&r!==o[0]&&o.pop(),o.push(n),r=n):p>=c&&(o.push(n),r=n)}}),o},filteredTimeMarkers(){return this.showTimeMarkers?this.showOnlyStartEndTimes?this.timeMarkers.length===0?[]:this.timeMarkers.length===1?[this.timeMarkers[0]]:[this.timeMarkers[0],this.timeMarkers[this.timeMarkers.length-1]]:this.timeMarkers:[]},uniqueStates(){return[...new Set(this.stateData.map(a=>a.state))]}},created(){this.$dataTracker(this.id,this.onInput,null,this.onDynamicProperty,null),this.$socket.emit("widget-load",this.id)},methods:{onInput(a){const e=a.ui_update;e&&(this.updateDynamicProperty("label",e.label),this.updateDynamicProperty("options",e.options),this.updateDynamicProperty("showTimeMarkers",e.showTimeMarkers),this.updateDynamicProperty("showOnlyStartEndTimes",e.showOnlyStartEndTimes))},onDynamicProperty(a){const e=a.ui_update;e&&(this.updateDynamicProperty("label",e.label),this.updateDynamicProperty("options",e.options),this.updateDynamicProperty("showTimeMarkers",e.showTimeMarkers),this.updateDynamicProperty("showOnlyStartEndTimes",e.showOnlyStartEndTimes))},getWidth(a){const e=new Date(a.start).getTime(),i=new Date(a.end).getTime();return i<=e||!this.totalDurationMs||this.totalDurationMs<=0?0:(i-e)/this.totalDurationMs*100},getColor(a){const e=this.stateDefinitions.find(i=>i.value===a);return e?e.color:"grey"},getStateLabel(a){const e=this.stateDefinitions.find(i=>i.value===a);return e?e.label:a},formatTime(a){let e;if(a instanceof Date)e=a;else if(typeof a=="string"||typeof a=="number")e=new Date(a);else return console.warn("Unsupported input type for formatTime:",a),"Invalid Time";if(!(e instanceof Date)||isNaN(e))return console.warn("Invalid date passed to formatTime:",a),"Invalid Time";const i=this.timeFormat||"HH:mm",o=e.getHours(),c=o%12===0?12:o%12,r=e.getMinutes(),n=o<12?"am":"pm",m=n.toUpperCase(),l=e.getFullYear(),d=String(l).slice(-2),p=e.getMonth()+1,g=e.getDate();return i.replace(/YYYY/g,String(l)).replace(/YY/g,d).replace(/MM/g,String(p).padStart(2,"0")).replace(/M/g,String(p)).replace(/DD/g,String(g).padStart(2,"0")).replace(/D/g,String(g)).replace(/hh/g,String(c).padStart(2,"0")).replace(/h/g,String(c)).replace(/HH/g,String(o).padStart(2,"0")).replace(/H/g,String(o)).replace(/mm/g,String(r).padStart(2,"0")).replace(/m/g,String(r)).replace(/a/g,n).replace(/A/g,m)},getFormattedDuration(a){const e=new Date(a.start),i=new Date(a.end),o=Math.round((i-e)/1e3/60);if(o>59){const c=Math.floor(o/60),r=o%60;let n=`${c} hour${c>1?"s":""}`;return r>0&&(n+=` ${r} minute${r>1?"s":""}`),n}else return`${o} minute${o!==1?"s":""}`}}},k={ref:"timelineContainer",class:"history-timeline"},S={class:"ui-state-timeline"},T={class:"legend"},M={style:{color:"var(--v-theme-on-group-background)",opacity:.5}},w={key:1,class:"no-data"},b={key:2,class:"time-axis"};function x(a,e,i,o,c,r){const n=t.resolveComponent("v-spacer"),m=t.resolveComponent("v-card-title"),l=t.resolveComponent("v-list-item-title"),d=t.resolveComponent("v-list-item-subtitle"),p=t.resolveComponent("v-list-item"),g=t.resolveComponent("v-list"),u=t.resolveComponent("v-card-text"),N=t.resolveComponent("v-card"),E=t.resolveComponent("v-menu"),V=t.resolveComponent("v-container");return t.openBlock(),t.createBlock(V,null,{default:t.withCtx(()=>[t.createElementVNode("div",k,[t.createElementVNode("div",S,[i.props.label?(t.openBlock(),t.createElementBlock("label",{key:0,ref:"title",class:"nrdb-ui-state-timeline-title"},t.toDisplayString(i.props.label),513)):t.createCommentVNode("",!0),t.createVNode(n),t.createElementVNode("div",T,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.uniqueStates,s=>(t.openBlock(),t.createElementBlock("span",{key:s,class:"legend-item"},[t.createElementVNode("span",{class:"color-box",style:t.normalizeStyle({backgroundColor:r.getColor(s)})},null,4),t.createElementVNode("span",M,t.toDisplayString(r.getStateLabel(s)),1)]))),128))])]),r.stateData.length>0?(t.openBlock(),t.createElementBlock("div",{key:0,ref:"timelineBar",class:"timeline-bar",style:t.normalizeStyle({height:r.barHeight+"px"})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.stateData,(s,y)=>(t.openBlock(),t.createBlock(E,{key:y,"open-on-hover":"","open-on-click":"","close-delay":100,"open-delay":200,location:"bottom",transition:"scale-transition",offset:"10"},{activator:t.withCtx(({props:B})=>[t.createElementVNode("div",t.mergeProps({ref_for:!0},B,{class:"timeline-segment",style:{width:r.getWidth(s)+"%",backgroundColor:r.getColor(s.state)}}),null,16)]),default:t.withCtx(()=>[t.createVNode(N,{class:"pa-0 details-card",width:"fit-content",style:{display:"inline-block",background:"rgb(var(--v-theme-surface)) !important"}},{default:t.withCtx(()=>[t.createVNode(m,{class:"text-caption pa-1"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.getStateLabel(s.state)),1)]),_:2},1024),t.createVNode(u,{class:"pa-0"},{default:t.withCtx(()=>[t.createVNode(g,{density:"compact",color:""},{default:t.withCtx(()=>[t.createVNode(p,null,{default:t.withCtx(()=>[t.createVNode(l,{class:"text-caption"},{default:t.withCtx(()=>e[0]||(e[0]=[t.createTextVNode("Start:")])),_:1}),t.createVNode(d,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.formatTime(new Date(s.start))),1)]),_:2},1024)]),_:2},1024),t.createVNode(p,null,{default:t.withCtx(()=>[t.createVNode(l,{class:"text-caption"},{default:t.withCtx(()=>e[1]||(e[1]=[t.createTextVNode("End:")])),_:1}),t.createVNode(d,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.formatTime(new Date(s.end))),1)]),_:2},1024)]),_:2},1024),t.createVNode(p,null,{default:t.withCtx(()=>[t.createVNode(l,{class:"text-caption"},{default:t.withCtx(()=>e[2]||(e[2]=[t.createTextVNode("Duration:")])),_:1}),t.createVNode(d,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.getFormattedDuration(s)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))],4)):(t.openBlock(),t.createElementBlock("div",w,"No history data available")),r.stateData.length>0&&r.showTimeMarkers?(t.openBlock(),t.createElementBlock("div",b,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.filteredTimeMarkers,(s,y)=>(t.openBlock(),t.createElementBlock("span",{key:y,class:"time-marker",style:t.normalizeStyle({left:s.position+"%",color:"var(--v-theme-on-group-background)",borderColor:"var(--v-theme-on-group-background)",opacity:.5})},t.toDisplayString(s.label),5))),128))])):t.createCommentVNode("",!0)],512)]),_:1})}const C=_(D,[["render",x],["__scopeId","data-v-e9c3e6de"]]);h.UIStateTimeline=C,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
