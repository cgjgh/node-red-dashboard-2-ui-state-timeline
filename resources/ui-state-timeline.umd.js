(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('.history-timeline[data-v-1e5f4d73]{position:relative;min-height:110px;box-sizing:border-box}.timeline-bar[data-v-1e5f4d73]{display:flex;flex-direction:row;width:100%;cursor:default;align-items:center}.timeline-segment[data-v-1e5f4d73]{height:100%;cursor:pointer;box-sizing:border-box;transition:box-shadow .2s ease,border .2s ease,transform .2s ease-in,border-radius .2s ease-in;transform-origin:center center;border-radius:0}.timeline-segment[data-v-1e5f4d73]:first-child{border-top-left-radius:6px;border-bottom-left-radius:6px}.timeline-segment[data-v-1e5f4d73]:last-child{border-top-right-radius:6px;border-bottom-right-radius:6px}.timeline-segment[data-v-1e5f4d73]:hover:not(.selected),.timeline-segment.selected[data-v-1e5f4d73]{transform:scaleY(1.3);z-index:5;border-radius:6px}.timeline-segment[data-v-1e5f4d73]:hover:not(.selected){box-shadow:0 0 15px 5px #0009}.timeline-segment.selected[data-v-1e5f4d73]{border:2px solid #000;box-shadow:0 0 15px 5px #0009}.timeline-segment:first-child.selected[data-v-1e5f4d73]{border-top-left-radius:6px;border-bottom-left-radius:6px}.timeline-segment:last-child.selected[data-v-1e5f4d73]{border-top-right-radius:6px;border-bottom-right-radius:6px}.no-data[data-v-1e5f4d73]{text-align:center;color:#888;padding:20px;font-style:italic}.time-axis[data-v-1e5f4d73]{position:relative;width:100%;height:20px;margin-top:8px;overflow:visible;-webkit-user-select:none;user-select:none}.time-marker[data-v-1e5f4d73]{position:absolute;bottom:0;transform:translate(-50%);font-size:10px;white-space:nowrap}.time-marker[data-v-1e5f4d73]:before{content:"";position:absolute;bottom:calc(100% + 1px);left:50%;transform:translate(-50%);width:1px;height:4px;background-color:#aaa}.ui-state-timeline[data-v-1e5f4d73]{display:flex;align-items:center;justify-content:space-between}.legend[data-v-1e5f4d73]{margin-top:15px;display:flex;justify-content:center;flex-wrap:wrap;padding:0 10px;gap:10px}.legend-item[data-v-1e5f4d73]{display:inline-flex;align-items:center;font-size:.8rem}.color-box[data-v-1e5f4d73]{display:inline-block;width:12px;height:12px;margin-right:5px;border-radius:3px;border:1px solid rgba(0,0,0,.1)}.details-card[data-v-1e5f4d73]{box-shadow:0 2px 10px #0003}.details-card .v-list-item[data-v-1e5f4d73]{min-height:28px;padding-top:2px;padding-bottom:2px}.details-card .v-list-item-title[data-v-1e5f4d73],.details-card .v-list-item-subtitle[data-v-1e5f4d73]{line-height:1.3}.details-card .v-card-title[data-v-1e5f4d73]{font-weight:700}.nrdb-ui-state-timeline-title[data-v-1e5f4d73]{display:block;text-align:center;font-weight:700;font-size:1rem;padding-bottom:4px}')),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
(function(p,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vuex"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vuex","vue"],f):(p=typeof globalThis<"u"?globalThis:p||self,f(p["ui-state-timeline"]={},p.vuex,p.Vue))})(this,function(p,f,t){"use strict";const T=(a,e)=>{const i=a.__vccOpts||a;for(const[n,s]of e)i[n]=s;return i},D={name:"DBStateTimeline",inject:["$socket","$dataTracker"],props:{id:{type:String,required:!0},props:{type:Object,default:()=>({})},state:{type:Object,default:()=>({})}},data(){return{}},computed:{...f.mapState("data",["messages"]),stateData(){var a,e;return((e=(a=this.messages[this.id])==null?void 0:a.payload)==null?void 0:e.stateData)||[]},title(){return this.getProperty("title")||"State Timeline"},barHeight(){return this.getProperty("barHeight")||30},timelineTimeFormat(){return this.getProperty("timelineTimeFormat")||"h:mm A"},detailsTimeFormat(){return this.getProperty("detailsTimeFormat")||"M/DD/YY h:mm A"},minTimeLabelGap(){return this.getProperty("minTimeLabelGap")||6},showTimeMarkers(){return this.getProperty("showTimeMarkers")!==void 0?!!this.getProperty("showTimeMarkers"):!0},showOnlyStartEndTimes(){return this.showTimeMarkers&&!!this.getProperty("showOnlyStartEndTimes")},stateDefinitions(){const a=this.getProperty("states");return Array.isArray(a)&&a.length>=2?a:(console.warn(`State definitions (props.states) for ${this.id} are missing or invalid. Using defaults.`),[{label:"On",value:"on",valueType:"str",color:"#009933"},{label:"Off",value:"off",valueType:"str",color:"#999999"}])},totalStartMs(){return this.stateData.length>0?new Date(this.stateData[0].start).getTime():null},totalEndMs(){return this.stateData.length>0?new Date(this.stateData[this.stateData.length-1].end).getTime():null},totalDurationMs(){return this.totalEndMs&&this.totalStartMs&&this.totalEndMs>this.totalStartMs?this.totalEndMs-this.totalStartMs:this.stateData.length>0&&this.totalEndMs===this.totalStartMs?1:0},timeMarkers(){if(!this.stateData.length||this.totalDurationMs<=0)return[];const a=[],e=this.totalStartMs,i=this.totalDurationMs;a.push({label:this.formatTime(new Date(e),this.timelineTimeFormat),position:0,time:e}),this.stateData.forEach((o,m)=>{const d=new Date(o.end).getTime();if(!a.some(c=>c.time===d)){const c=Math.min(100,Math.max(0,(d-e)/i*100));a.push({label:this.formatTime(new Date(o.end),this.timelineTimeFormat),position:c,time:d})}}),a.sort((o,m)=>o.position-m.position||o.time-m.time);const n=[],s=Number(this.minTimeLabelGap)>=0?Number(this.minTimeLabelGap):6;let r=null;return a.forEach((o,m)=>{const d=m===0,c=m===a.length-1;if(d)n.push(o),r=o;else{if(!r)return;const h=o.position-r.position;c?(h<s&&n.length>1&&r!==n[0]&&n.pop(),n.push(o),r=o):h>=s&&(n.push(o),r=o)}}),n},filteredTimeMarkers(){return this.showTimeMarkers?this.showOnlyStartEndTimes?this.timeMarkers.length===0?[]:this.timeMarkers.length===1?[this.timeMarkers[0]]:[this.timeMarkers[0],this.timeMarkers[this.timeMarkers.length-1]]:this.timeMarkers:[]},uniqueStates(){return[...new Set(this.stateData.map(a=>a.state))]}},created(){this.$dataTracker(this.id,this.onInput,null,this.onDynamicProperty,null),this.$socket.emit("widget-load",this.id)},methods:{onInput(a){const e=a.ui_update;e&&(this.updateDynamicProperty("label",e.label),this.updateDynamicProperty("options",e.options),this.updateDynamicProperty("showTimeMarkers",e.showTimeMarkers),this.updateDynamicProperty("showOnlyStartEndTimes",e.showOnlyStartEndTimes),this.updateDynamicProperty("timelineTimeFormat",e.timelineTimeFormat),this.updateDynamicProperty("detailsTimeFormat",e.detailsTimeFormat))},onDynamicProperty(a){const e=a.ui_update;e&&(this.updateDynamicProperty("label",e.label),this.updateDynamicProperty("options",e.options),this.updateDynamicProperty("showTimeMarkers",e.showTimeMarkers),this.updateDynamicProperty("showOnlyStartEndTimes",e.showOnlyStartEndTimes),this.updateDynamicProperty("timelineTimeFormat",e.timelineTimeFormat),this.updateDynamicProperty("detailsTimeFormat",e.detailsTimeFormat))},getWidth(a){const e=new Date(a.start).getTime(),i=new Date(a.end).getTime();return i<=e||!this.totalDurationMs||this.totalDurationMs<=0?0:(i-e)/this.totalDurationMs*100},getColor(a){const e=this.stateDefinitions.find(i=>i.value===a);return e?e.color:"grey"},getStateLabel(a){const e=this.stateDefinitions.find(i=>i.value===a);return e?e.label:a},formatTime(a,e){let i;if(a instanceof Date)i=a;else if(typeof a=="string"||typeof a=="number")i=new Date(a);else return console.warn("Unsupported input type for formatTime:",a),"Invalid Time";if(!(i instanceof Date)||isNaN(i))return console.warn("Invalid date passed to formatTime:",a),"Invalid Time";const n=e||this.timelineTimeFormat||"HH:mm",s=i.getHours(),r=s%12===0?12:s%12,o=i.getMinutes(),m=s<12?"am":"pm",d=m.toUpperCase(),c=i.getFullYear(),h=String(c).slice(-2),g=i.getMonth()+1,y=i.getDate();return n.replace(/YYYY/g,String(c)).replace(/YY/g,h).replace(/MM/g,String(g).padStart(2,"0")).replace(/M/g,String(g)).replace(/DD/g,String(y).padStart(2,"0")).replace(/D/g,String(y)).replace(/hh/g,String(r).padStart(2,"0")).replace(/h/g,String(r)).replace(/HH/g,String(s).padStart(2,"0")).replace(/H/g,String(s)).replace(/mm/g,String(o).padStart(2,"0")).replace(/m/g,String(o)).replace(/a/g,m).replace(/A/g,d)},getFormattedDuration(a){const e=new Date(a.start),i=new Date(a.end),n=Math.round((i-e)/1e3/60);if(n>59){const s=Math.floor(n/60),r=n%60;let o=`${s} hour${s>1?"s":""}`;return r>0&&(o+=` ${r} minute${r>1?"s":""}`),o}else return`${n} minute${n!==1?"s":""}`}}},k={ref:"timelineContainer",class:"history-timeline"},S={class:"ui-state-timeline"},M={class:"legend"},w={style:{color:"var(--v-theme-on-group-background)",opacity:.5}},b={key:1,class:"no-data"},x={key:2,class:"time-axis"};function C(a,e,i,n,s,r){const o=t.resolveComponent("v-spacer"),m=t.resolveComponent("v-card-title"),d=t.resolveComponent("v-list-item-title"),c=t.resolveComponent("v-list-item-subtitle"),h=t.resolveComponent("v-list-item"),g=t.resolveComponent("v-list"),y=t.resolveComponent("v-card-text"),_=t.resolveComponent("v-card"),E=t.resolveComponent("v-menu"),P=t.resolveComponent("v-container");return t.openBlock(),t.createBlock(P,null,{default:t.withCtx(()=>[t.createElementVNode("div",k,[t.createElementVNode("div",S,[i.props.label?(t.openBlock(),t.createElementBlock("label",{key:0,ref:"title",class:"nrdb-ui-state-timeline-title"},t.toDisplayString(i.props.label),513)):t.createCommentVNode("",!0),t.createVNode(o),t.createElementVNode("div",M,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.uniqueStates,l=>(t.openBlock(),t.createElementBlock("span",{key:l,class:"legend-item"},[t.createElementVNode("span",{class:"color-box",style:t.normalizeStyle({backgroundColor:r.getColor(l)})},null,4),t.createElementVNode("span",w,t.toDisplayString(r.getStateLabel(l)),1)]))),128))])]),r.stateData.length>0?(t.openBlock(),t.createElementBlock("div",{key:0,ref:"timelineBar",class:"timeline-bar",style:t.normalizeStyle({height:r.barHeight+"px"})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.stateData,(l,u)=>(t.openBlock(),t.createBlock(E,{key:u,"open-on-hover":"","open-on-click":"","close-delay":100,"open-delay":200,location:"bottom",transition:"scale-transition",offset:"10"},{activator:t.withCtx(({props:V})=>[t.createElementVNode("div",t.mergeProps({ref_for:!0},V,{class:"timeline-segment",style:{width:r.getWidth(l)+"%",backgroundColor:r.getColor(l.state)}}),null,16)]),default:t.withCtx(()=>[t.createVNode(_,{class:"pa-0 details-card",width:"fit-content",style:{display:"inline-block",background:"rgb(var(--v-theme-surface)) !important"}},{default:t.withCtx(()=>[t.createVNode(m,{class:"text-caption pa-1"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.getStateLabel(l.state)),1)]),_:2},1024),t.createVNode(y,{class:"pa-0"},{default:t.withCtx(()=>[t.createVNode(g,{density:"compact",color:""},{default:t.withCtx(()=>[t.createVNode(h,null,{default:t.withCtx(()=>[t.createVNode(d,{class:"text-caption"},{default:t.withCtx(()=>e[0]||(e[0]=[t.createTextVNode("Start:")])),_:1}),t.createVNode(c,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.formatTime(new Date(l.start),r.detailsTimeFormat)),1)]),_:2},1024)]),_:2},1024),t.createVNode(h,null,{default:t.withCtx(()=>[t.createVNode(d,{class:"text-caption"},{default:t.withCtx(()=>e[1]||(e[1]=[t.createTextVNode("End:")])),_:1}),t.createVNode(c,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.formatTime(new Date(l.end),r.detailsTimeFormat)),1)]),_:2},1024)]),_:2},1024),t.createVNode(h,null,{default:t.withCtx(()=>[t.createVNode(d,{class:"text-caption"},{default:t.withCtx(()=>e[2]||(e[2]=[t.createTextVNode("Duration:")])),_:1}),t.createVNode(c,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(r.getFormattedDuration(l)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))],4)):(t.openBlock(),t.createElementBlock("div",b,"No history data available")),r.stateData.length>0&&r.showTimeMarkers?(t.openBlock(),t.createElementBlock("div",x,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.filteredTimeMarkers,(l,u)=>(t.openBlock(),t.createElementBlock("span",{key:u,class:"time-marker",style:t.normalizeStyle({left:l.position+"%",color:"var(--v-theme-on-group-background)",borderColor:"var(--v-theme-on-group-background)",opacity:.5})},t.toDisplayString(l.label),5))),128))])):t.createCommentVNode("",!0)],512)]),_:1})}const N=T(D,[["render",C],["__scopeId","data-v-1e5f4d73"]]);p.UIStateTimeline=N,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
