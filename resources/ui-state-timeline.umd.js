(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('.history-timeline[data-v-8054402c]{position:relative;min-height:110px;box-sizing:border-box}.timeline-bar[data-v-8054402c]{display:flex;flex-direction:row;width:100%;cursor:default;align-items:center}.timeline-segment[data-v-8054402c]{height:100%;cursor:pointer;box-sizing:border-box;transition:box-shadow .2s ease,border .2s ease,transform .2s ease-in,border-radius .2s ease-in;transform-origin:center center;border-radius:0}.timeline-segment[data-v-8054402c]:first-child{border-top-left-radius:6px;border-bottom-left-radius:6px}.timeline-segment[data-v-8054402c]:last-child{border-top-right-radius:6px;border-bottom-right-radius:6px}.timeline-segment[data-v-8054402c]:hover:not(.selected),.timeline-segment.selected[data-v-8054402c]{transform:scaleY(1.3);z-index:5;border-radius:6px}.timeline-segment[data-v-8054402c]:hover:not(.selected){box-shadow:0 0 15px 5px #0009}.timeline-segment.selected[data-v-8054402c]{border:2px solid #000;box-shadow:0 0 15px 5px #0009}.timeline-segment:first-child.selected[data-v-8054402c]{border-top-left-radius:6px;border-bottom-left-radius:6px}.timeline-segment:last-child.selected[data-v-8054402c]{border-top-right-radius:6px;border-bottom-right-radius:6px}.no-data[data-v-8054402c]{text-align:center;color:#888;padding:20px;font-style:italic}.time-axis[data-v-8054402c]{position:relative;width:100%;height:20px;margin-top:8px;overflow:visible;-webkit-user-select:none;user-select:none}.time-marker[data-v-8054402c]{position:absolute;bottom:0;transform:translate(-50%);font-size:10px;color:#555;white-space:nowrap}.time-marker[data-v-8054402c]:before{content:"";position:absolute;bottom:calc(100% + 1px);left:50%;transform:translate(-50%);width:1px;height:4px;background-color:#aaa}.ui-state-timeline[data-v-8054402c]{display:flex;align-items:center;justify-content:space-between}.legend[data-v-8054402c]{margin-top:15px;display:flex;justify-content:center;flex-wrap:wrap;padding:0 10px;gap:10px}.legend-item[data-v-8054402c]{display:inline-flex;align-items:center;font-size:.8rem;color:#333}.color-box[data-v-8054402c]{display:inline-block;width:12px;height:12px;margin-right:5px;border-radius:3px;border:1px solid rgba(0,0,0,.1)}.details-card[data-v-8054402c]{box-shadow:0 2px 10px #0003}.details-card .v-list-item[data-v-8054402c]{min-height:28px;padding-top:2px;padding-bottom:2px}.details-card .v-list-item-title[data-v-8054402c],.details-card .v-list-item-subtitle[data-v-8054402c]{line-height:1.3}.details-card .v-card-title[data-v-8054402c]{font-weight:700}.nrdb-ui-state-timeline-title[data-v-8054402c]{display:block;text-align:center;font-weight:700;font-size:1rem;padding-bottom:4px}')),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
(function(p,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("vuex"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vuex","vue"],g):(p=typeof globalThis<"u"?globalThis:p||self,g(p["ui-state-timeline"]={},p.vuex,p.Vue))})(this,function(p,g,t){"use strict";const k=(i,e)=>{const s=i.__vccOpts||i;for(const[r,d]of e)s[r]=d;return s},T={name:"DBStateTimeline",inject:["$socket","$dataTracker"],props:{id:{type:String,required:!0},props:{type:Object,default:()=>({})},state:{type:Object,default:()=>({})}},data(){return{selectedSegment:null,hoveredSegment:null,cardTop:0,cardLeft:0,cardVisible:!1}},computed:{...g.mapState("data",["messages"]),stateData(){var i,e;return((e=(i=this.messages[this.id])==null?void 0:i.payload)==null?void 0:e.stateData)||[]},title(){return this.getProperty("title")||"State Timeline"},barHeight(){return this.getProperty("barHeight")||30},timeFormat(){return this.getProperty("timeFormat")||"hh:mm a"},minTimeLabelGap(){return this.getProperty("minTimeLabelGap")||6},showTimeMarkers(){return this.getProperty("showTimeMarkers")!==void 0?!!this.getProperty("showTimeMarkers"):!0},showOnlyStartEndTimes(){return this.showTimeMarkers&&!!this.getProperty("showOnlyStartEndTimes")},stateDefinitions(){const i=this.getProperty("states");return Array.isArray(i)&&i.length>=2?i:(console.warn(`State definitions (props.states) for ${this.id} are missing or invalid (requires array with >= 2 items). Using defaults. Received:`,i),[{label:"On",value:"on",valueType:"str",color:"#009933"},{label:"Off",value:"off",valueType:"str",color:"#999999"}])},displaySegment(){return this.selectedSegment||this.hoveredSegment},cardStyle(){return{position:"absolute",top:`${this.cardTop}px`,left:`${this.cardLeft}px`,zIndex:10,width:"200px"}},totalStartMs(){return this.stateData.length>0?new Date(this.stateData[0].start).getTime():null},totalEndMs(){return this.stateData.length>0?new Date(this.stateData[this.stateData.length-1].end).getTime():null},totalDurationMs(){return this.totalEndMs&&this.totalStartMs&&this.totalEndMs>this.totalStartMs?this.totalEndMs-this.totalStartMs:this.stateData.length>0&&this.totalEndMs===this.totalStartMs?1:0},timeMarkers(){if(!this.stateData.length||this.totalDurationMs<=0)return[];const i=[],e=this.totalStartMs,s=this.totalDurationMs;if(i.push({label:this.formatTime(new Date(e)),position:0,time:e}),this.stateData.forEach((a,c)=>{const o=new Date(a.end).getTime();if(!i.some(m=>m.time===o)){const m=Math.min(100,Math.max(0,(o-e)/s*100));i.push({label:this.formatTime(new Date(a.end)),position:m,time:o})}}),i.length<=1)return i;i.sort((a,c)=>a.position-c.position||a.time-c.time);const r=[],d=Number(this.minTimeLabelGap)>=0?Number(this.minTimeLabelGap):6;let n=null;return i.forEach((a,c)=>{const o=c===0,m=c===i.length-1;if(o)r.push(a),n=a;else{if(!n)return;const h=a.position-n.position;m?(h<d&&r.length>1&&n!==r[0]&&r.pop(),r.push(a),n=a):h>=d&&(r.push(a),n=a)}}),r},filteredTimeMarkers(){return this.showTimeMarkers?this.showOnlyStartEndTimes?this.timeMarkers.length===0?[]:this.timeMarkers.length===1?[this.timeMarkers[0]]:[this.timeMarkers[0],this.timeMarkers[this.timeMarkers.length-1]]:this.timeMarkers:[]},uniqueStates(){return[...new Set(this.stateData.map(i=>i.state))]}},created(){this.$dataTracker(this.id,this.onInput,null,this.onDynamicProperty,null),this.$socket.emit("widget-load",this.id)},methods:{onInput(i){const e=i.ui_update;e&&(this.updateDynamicProperty("label",e.label),this.updateDynamicProperty("options",e.options),this.updateDynamicProperty("showTimeMarkers",e.showTimeMarkers),this.updateDynamicProperty("showOnlyStartEndTimes",e.showOnlyStartEndTimes))},onDynamicProperty(i){const e=i.ui_update;e&&(this.updateDynamicProperty("label",e.label),this.updateDynamicProperty("options",e.options),this.updateDynamicProperty("showTimeMarkers",e.showTimeMarkers),this.updateDynamicProperty("showOnlyStartEndTimes",e.showOnlyStartEndTimes))},getWidth(i){const e=new Date(i.start).getTime(),s=new Date(i.end).getTime();return s<=e||!this.totalDurationMs||this.totalDurationMs<=0?0:(s-e)/this.totalDurationMs*100},getColor(i){const e=this.stateDefinitions.find(s=>s.value===i);return e?e.color:"grey"},getStateLabel(i){const e=this.stateDefinitions.find(s=>s.value===i);return e?e.label:i},calculateCardPosition(i){if(!this.$refs.timelineBar||!i||!this.$refs.timelineContainer){console.warn("Timeline refs not ready for card positioning.");return}const e=this.$refs.timelineBar.getBoundingClientRect(),s=i.getBoundingClientRect(),r=this.$refs.timelineContainer.getBoundingClientRect();this.cardTop=e.bottom-r.top+5;const d=s.left+s.width/2,n=200;let a=d-r.left-n/2;const c=this.$refs.timelineContainer.offsetWidth,o=5;a+n>c-o&&(a=c-n-o),a<o&&(a=o),this.cardLeft=a},onSegmentMouseEnter(i,e){this.selectedSegment||(this.hoveredSegment=i,this.$nextTick(()=>{this.$refs.detailsCard&&this.calculateCardPosition(e.target)}))},onSegmentMouseLeave(){(!this.selectedSegment||this.hoveredSegment!==this.selectedSegment)&&(this.hoveredSegment=null)},onSegmentClick(i,e){this.selectedSegment===i?(this.selectedSegment=null,this.hoveredSegment=null):(this.selectedSegment=i,this.hoveredSegment=i,this.$nextTick(()=>{this.$refs.detailsCard&&this.calculateCardPosition(e.target)}))},onTimelineClick(i){i.target===this.$refs.timelineBar&&(this.selectedSegment=null,this.hoveredSegment=null)},formatTime(i){let e;if(i instanceof Date)e=i;else if(typeof i=="string"||typeof i=="number")e=new Date(i);else return console.warn("Unsupported input type for formatTime:",i),"Invalid Time";if(!(e instanceof Date)||isNaN(e))return console.warn("Invalid date passed to formatTime:",i),"Invalid Time";const s=this.timeFormat||"HH:mm",r=e.getHours(),d=r%12===0?12:r%12,n=e.getMinutes(),a=r<12?"am":"pm",c=a.toUpperCase(),o=e.getFullYear(),m=String(o).slice(-2),h=e.getMonth()+1,y=e.getDate();return s.replace(/YYYY/g,String(o)).replace(/YY/g,m).replace(/MM/g,String(h).padStart(2,"0")).replace(/M/g,String(h)).replace(/DD/g,String(y).padStart(2,"0")).replace(/D/g,String(y)).replace(/hh/g,String(d).padStart(2,"0")).replace(/h/g,String(d)).replace(/HH/g,String(r).padStart(2,"0")).replace(/H/g,String(r)).replace(/mm/g,String(n).padStart(2,"0")).replace(/m/g,String(n)).replace(/a/g,a).replace(/A/g,c)}}},_={ref:"timelineContainer",class:"history-timeline"},D={class:"ui-state-timeline"},M={class:"legend"},C=["onClick","onMouseenter"],w={key:1,class:"no-data"},x={key:2,class:"time-axis"};function b(i,e,s,r,d,n){const a=t.resolveComponent("v-spacer"),c=t.resolveComponent("v-card-title"),o=t.resolveComponent("v-list-item-title"),m=t.resolveComponent("v-list-item-subtitle"),h=t.resolveComponent("v-list-item"),y=t.resolveComponent("v-list"),u=t.resolveComponent("v-card-text"),N=t.resolveComponent("v-card"),E=t.resolveComponent("v-container");return t.openBlock(),t.createBlock(E,null,{default:t.withCtx(()=>[t.createElementVNode("div",_,[t.createElementVNode("div",D,[s.props.label?(t.openBlock(),t.createElementBlock("label",{key:0,ref:"title",class:"nrdb-ui-state-timeline-title"},t.toDisplayString(s.props.label),513)):t.createCommentVNode("v-if",!0),t.createVNode(a),t.createElementVNode("div",M,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.uniqueStates,l=>(t.openBlock(),t.createElementBlock("span",{key:l,class:"legend-item"},[t.createElementVNode("span",{class:"color-box",style:t.normalizeStyle({backgroundColor:n.getColor(l)})},null,4),t.createTextVNode(" "+t.toDisplayString(n.getStateLabel(l)),1)]))),128))])]),n.stateData.length>0?(t.openBlock(),t.createElementBlock("div",{key:0,ref:"timelineBar",class:"timeline-bar",style:t.normalizeStyle({height:n.barHeight+"px"}),onClick:e[1]||(e[1]=(...l)=>n.onTimelineClick&&n.onTimelineClick(...l))},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.stateData,(l,S)=>(t.openBlock(),t.createElementBlock("div",{key:S,class:t.normalizeClass(["timeline-segment",{selected:l===d.selectedSegment}]),style:t.normalizeStyle({width:n.getWidth(l)+"%",backgroundColor:n.getColor(l.state)}),onClick:t.withModifiers(f=>n.onSegmentClick(l,f),["stop"]),onMouseenter:f=>n.onSegmentMouseEnter(l,f),onMouseleave:e[0]||(e[0]=(...f)=>n.onSegmentMouseLeave&&n.onSegmentMouseLeave(...f))},null,46,C))),128))],4)):(t.openBlock(),t.createElementBlock("div",w,"No history data available")),n.stateData.length>0&&n.showTimeMarkers?(t.openBlock(),t.createElementBlock("div",x,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.filteredTimeMarkers,(l,S)=>(t.openBlock(),t.createElementBlock("span",{key:S,class:"time-marker",style:t.normalizeStyle({left:l.position+"%"})},t.toDisplayString(l.label),5))),128))])):t.createCommentVNode("v-if",!0),n.displaySegment?(t.openBlock(),t.createBlock(N,{key:3,ref:"detailsCard",class:"pa-2 details-card",style:t.normalizeStyle(n.cardStyle),elevation:"4"},{default:t.withCtx(()=>[t.createVNode(c,{class:"text-caption pa-1"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(n.getStateLabel(n.displaySegment.state)),1)]),_:1}),t.createVNode(u,{class:"pa-1"},{default:t.withCtx(()=>[t.createVNode(y,{dense:""},{default:t.withCtx(()=>[t.createVNode(h,null,{default:t.withCtx(()=>[t.createVNode(o,{class:"text-caption"},{default:t.withCtx(()=>e[2]||(e[2]=[t.createTextVNode("Start:")])),_:1}),t.createVNode(m,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(n.formatTime(new Date(n.displaySegment.start))),1)]),_:1})]),_:1}),t.createVNode(h,null,{default:t.withCtx(()=>[t.createVNode(o,{class:"text-caption"},{default:t.withCtx(()=>e[3]||(e[3]=[t.createTextVNode("End:")])),_:1}),t.createVNode(m,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(n.formatTime(new Date(n.displaySegment.end))),1)]),_:1})]),_:1}),t.createVNode(h,null,{default:t.withCtx(()=>[t.createVNode(o,{class:"text-caption"},{default:t.withCtx(()=>e[4]||(e[4]=[t.createTextVNode("Duration:")])),_:1}),t.createVNode(m,{class:"text-body-2"},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(Math.round((new Date(n.displaySegment.end)-new Date(n.displaySegment.start))/1e3/60))+" minutes ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])):t.createCommentVNode("v-if",!0)],512)]),_:1})}const B=k(T,[["render",b],["__scopeId","data-v-8054402c"],["__file","C:/Users/cgjgh/Documents/GitHub/node-red-dashboard-2-ui-state-timeline/ui/components/UIStateTimeline.vue"]]);p.UIStateTimeline=B,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=ui-state-timeline.umd.js.map
